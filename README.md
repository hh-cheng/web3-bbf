# web3-BBF
### BFF 是什么
- **定义**: BFF（Backend for Frontend）是介于前端与多个后端/第三方服务之间的“前端专用后端”。它按前端页面/组件的需要对数据进行聚合、整形、裁剪，并统一鉴权、缓存与错误处理。

### 本项目中的 BFF 架构（NestJS）
- **入口与装配**: `src/app.module.ts` 负责模块注册（中间件、拦截器、视图引擎、静态资源等）。
- **路由层**: `src/app.controller.ts` 暴露前端使用的 API（如 `/api/...`），按页面或组件维度组织。
- **业务聚合层**: `src/app.service.ts` 编排调用上游（内部服务、第三方、链上 RPC 等）、聚合数据并输出前端友好的结构。
- **运行与编译**: `src/main.ts` 启动服务，`dist/` 为编译产物。
- **前端交付**: `public/` 提供打包静态资源，`views/` 下 `*.hbs` 视图用于 SSR（若需要）。
- **测试**: `test/` 存放 e2e 等测试。

### 实现原理与关键点
- **面向前端设计接口**: 以“页面/组件”为单位暴露精简接口，减少前端拼装与往返次数。
- **聚合与编排**: 在 `app.service.ts` 合并多源数据（REST/GraphQL/Web3 RPC），隐藏上游差异。
- **数据整形/防腐**: 使用 DTO/Mapper 输出稳定契约，隔离上游字段变化对前端的影响。
- **性能与稳定性**: 缓存（内存/Redis）、批量请求、限流/降级；Nest 可用拦截器实现。
- **安全**: 统一鉴权与授权、输入验证、CORS/CSRF 策略、敏感信息脱敏日志。
- **一致错误模型**: 全局异常过滤器将上游错误映射为统一响应。
- **可观测性**: 结构化日志、指标与链路追踪，定位问题更快。

### 在此项目中如何落地一个新页面的数据接口
1. 在 `app.controller.ts` 新增路由（如 `GET /api/pageX`）。
2. 在 `app.service.ts` 编写聚合逻辑（调用内部/第三方/Web3 provider，整形为前端所需）。
3. 在 `app.module.ts` 挂载校验管道、拦截器、过滤器与必要模块（缓存/HTTP 客户端等）。
4. 如需 SSR，在 `views/` 新增 `*.hbs`，并在控制器中返回视图或数据。

——
- 本项目用 NestJS 实现 BFF：控制器对外、服务层聚合、模块装配、`public/` 与 `views/` 提供前端交付。  
- 关键价值：按前端需求聚合裁剪、统一安全与容错、提升性能与演进弹性。
